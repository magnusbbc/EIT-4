//Display
MOVI 24 $r1           // Display mode- 15 for hex and 24 for decimal
STORE $r1 [65001]
//ISR
MOVI 65102 $r1
MOVI #I2SISR $r2 // I2S_out Interrupt serivce routine
STORE $r2 [$r1]
MOVI 512 $r2
STORE $r2 [$r1+1]

MOVI 65100 $r1
MOVI #BTNISR $r2      // Button ISR
STORE $r2 [$r1]
MOVI 512 $r2 //Enable interrupt, disable nesting
STORE $r2 [$r1+1]

//GRAPH
//64000 - 64639 addresses for Graph points
//Colors black: 546 , white : 2594 , blue: 2713 , red:554
MOVI 546 $r1        //64641 bckgrnd colour 12 lsb 4B 4G 4R
STORE $r1 [64641] 
MOVI 554 $r1       //64642 paint colour 12 lsb 4B 4G 4R
STORE $r1 [64642] 
MOVI 2713 $r1       //64643 grid colour 12 lsb 4B 4G 4R
STORE $r1 [64643] 
MOVI 20 $r1         //64644 h grid space
STORE $r1 [64644] 
MOVI 20 $r1         //64645 v grid space
STORE $r1 [64645] 
MOVI 2 $r1          //64646 line thickness
STORE $r1 [64646] 
MOVI 1 $r1          //64647 line mode on lsb
STORE $r1 [64647] 
MOVI 20000 $r1          //64647 line mode on lsb
STORE $r1 [64640] 
JMP #filter//Go to main



I2SISR:
NOP
 
LOAD $r5 [65011]// load I2S signal
ADDI $r5 -10000 $r5
ADDI $r6 1 $r6  //counter++
MOVI 319 $r7    //ref max count
CMP $r6 $r7     //check if should reset
JMPLE #nr
MOVI 0 $r6      //reset
nr:
NOP
ADDI $r6 64000 $r8//get counter and calc address
ADDI $r5 10000 $r19
STORE $r19 [$r8]     //show datapoint
//STORE $r5 [65000] // Print i2s to sseg

FIRSAR $r5 $r5 //FILTER

STORE $r5 [65010]   //output i2s

ADDI $r6 64320 $r8 // get address to paint to
//ADDI $r5 10000 $r5
ADDI $r5 10000 $r19
STORE $r19 [$r8]     //show datapoint
POP $pc

//BUTTONS
BTNISR:
NOP
LOAD $r11 [65002]
CMPI $r11 1
JMPEQ #btn0
CMPI $r11 2
JMPEQ #btn1
CMPI $r11 4
JMPEQ #btn2
POP $pc
btn0:
NOP
POP $pc


btn1:
NOP
//LOAD $r11 [10001] //toggler Start
ADDI $r12 1 $r12
CMPI $r12 5     //check if should reset
JMPLE #resbtn1f
MOVI 0 $r12      //reset
resbtn1f:
NOP
//STORE $r11 [10001]//toggler end
CMPI $r12 1
JMPEQ #LOWPASS400
CMPI $r12 2
JMPEQ #LOWPASS4000
CMPI $r12 3
JMPEQ #HIGHPASS400
CMPI $r12 4
JMPEQ #HIGHPASS4000
CMPI $r12 0
JMPEQ #ALL_PASS
POP $pc
btn2:
NOP
ADDI $r10 1 $r10
STORE $r10 [64647]
POP $pc




main:
NOP
NOP
NOP
NOP
JMP #main

filter:
NOP
NOP
MOVI 0 $r20 
STORE $r20 [65000]
FIRCOI 32767
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0

JMP #main

LOWPASS400:
NOP
MOVI -400 $r20 
STORE $r20 [65000]
FIRCOI 45
FIRCOI 49
FIRCOI 55
FIRCOI 64
FIRCOI 77
FIRCOI 94
FIRCOI 114
FIRCOI 138
FIRCOI 166
FIRCOI 198
FIRCOI 233
FIRCOI 272
FIRCOI 314
FIRCOI 358
FIRCOI 405
FIRCOI 454
FIRCOI 505
FIRCOI 556
FIRCOI 608
FIRCOI 659
FIRCOI 710
FIRCOI 759
FIRCOI 806
FIRCOI 850
FIRCOI 891
FIRCOI 928
FIRCOI 960
FIRCOI 988
FIRCOI 1011
FIRCOI 1029
FIRCOI 1040
FIRCOI 1046
FIRCOI 1046
FIRCOI 1040
FIRCOI 1029
FIRCOI 1011
FIRCOI 988
FIRCOI 960
FIRCOI 928
FIRCOI 891
FIRCOI 850
FIRCOI 806
FIRCOI 759
FIRCOI 710
FIRCOI 659
FIRCOI 608
FIRCOI 556
FIRCOI 505
FIRCOI 454
FIRCOI 405
FIRCOI 358
FIRCOI 314
FIRCOI 272
FIRCOI 233
FIRCOI 198
FIRCOI 166
FIRCOI 138
FIRCOI 114
FIRCOI 94
FIRCOI 77
FIRCOI 64
FIRCOI 55
FIRCOI 49
FIRCOI 45
POP $pc

LOWPASS4000:
NOP
MOVI -4000 $r20 
STORE $r20 [65000]
FIRCOI -20
FIRCOI -28
FIRCOI -29
FIRCOI -20
FIRCOI 0
FIRCOI 29
FIRCOI 60
FIRCOI 79
FIRCOI 74
FIRCOI 33
FIRCOI -40
FIRCOI -127
FIRCOI -197
FIRCOI -213
FIRCOI -149
FIRCOI 0
FIRCOI 201
FIRCOI 392
FIRCOI 492
FIRCOI 434
FIRCOI 187
FIRCOI -216
FIRCOI -672
FIRCOI -1028
FIRCOI -1112
FIRCOI -788
FIRCOI 0
FIRCOI 1198
FIRCOI 2641
FIRCOI 4079
FIRCOI 5239
FIRCOI 5886
FIRCOI 5886
FIRCOI 5239
FIRCOI 4079
FIRCOI 2641
FIRCOI 1198
FIRCOI 0
FIRCOI -788
FIRCOI -1112
FIRCOI -1028
FIRCOI -672
FIRCOI -216
FIRCOI 187
FIRCOI 434
FIRCOI 492
FIRCOI 392
FIRCOI 201
FIRCOI 0
FIRCOI -149
FIRCOI -213
FIRCOI -197
FIRCOI -127
FIRCOI -40
FIRCOI 33
FIRCOI 74
FIRCOI 79
FIRCOI 60
FIRCOI 29
FIRCOI 0
FIRCOI -20
FIRCOI -29
FIRCOI -28
FIRCOI -20
POP $pc

HIGHPASS400:
NOP
MOVI 400 $r20 
STORE $r20 [65000]
FIRCOI 6
FIRCOI 5
FIRCOI 4
FIRCOI 2
FIRCOI 0
FIRCOI -3
FIRCOI -7
FIRCOI -14
FIRCOI -22
FIRCOI -33
FIRCOI -47
FIRCOI -65
FIRCOI -88
FIRCOI -115
FIRCOI -148
FIRCOI -188
FIRCOI -235
FIRCOI -290
FIRCOI -356
FIRCOI -433
FIRCOI -524
FIRCOI -631
FIRCOI -760
FIRCOI -916
FIRCOI -1109
FIRCOI -1356
FIRCOI -1682
FIRCOI -2139
FIRCOI -2839
FIRCOI -4070
FIRCOI -6891
FIRCOI -20836
FIRCOI 20836
FIRCOI 6891
FIRCOI 4070
FIRCOI 2839
FIRCOI 2139
FIRCOI 1682
FIRCOI 1356
FIRCOI 1109
FIRCOI 916
FIRCOI 760
FIRCOI 631
FIRCOI 524
FIRCOI 433
FIRCOI 356
FIRCOI 290
FIRCOI 235
FIRCOI 188
FIRCOI 148
FIRCOI 115
FIRCOI 88
FIRCOI 65
FIRCOI 47
FIRCOI 33
FIRCOI 22
FIRCOI 14
FIRCOI 7
FIRCOI 3
FIRCOI 0
FIRCOI -2
FIRCOI -4
FIRCOI -5
FIRCOI -6
POP $pc

HIGHPASS4000:
NOP
MOVI 4000 $r20 
STORE $r20 [65000]
FIRCOI -17
FIRCOI -4
FIRCOI 13
FIRCOI 31
FIRCOI 44
FIRCOI 45
FIRCOI 27
FIRCOI -11
FIRCOI -64
FIRCOI -113
FIRCOI -135
FIRCOI -110
FIRCOI -28
FIRCOI 97
FIRCOI 231
FIRCOI 320
FIRCOI 312
FIRCOI 179
FIRCOI  -71
FIRCOI -375
FIRCOI -635
FIRCOI -734
FIRCOI -582
FIRCOI -148
FIRCOI 507
FIRCOI 1225
FIRCOI 1770
FIRCOI 1862
FIRCOI 1204
FIRCOI -586
FIRCOI -4533
FIRCOI -20018
FIRCOI 20018
FIRCOI 4533
FIRCOI 586
FIRCOI -1204
FIRCOI -1862
FIRCOI -1770
FIRCOI -1225
FIRCOI -507
FIRCOI 148
FIRCOI 582
FIRCOI 734
FIRCOI 635
FIRCOI 375
FIRCOI 71
FIRCOI -179
FIRCOI -312
FIRCOI -320
FIRCOI -231
FIRCOI -97
FIRCOI 28
FIRCOI 110
FIRCOI 135
FIRCOI 113
FIRCOI 64
FIRCOI 11
FIRCOI -27
FIRCOI -45
FIRCOI -44
FIRCOI -31
FIRCOI -13
FIRCOI 4
FIRCOI 17
POP $pc

ALL_PASS:
NOP
MOVI 0 $r20 
STORE $r20 [65000]
FIRCOI 32767
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0
FIRCOI 0

POP $pc